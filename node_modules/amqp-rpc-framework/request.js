const amqp = require('amqplib')
const request = require('amqplib-rpc').request;

class Request {
    constructor(procedure, args, connection) {
        this.connection = connection;
        this.procedure = procedure;
        this.args = args;
        this.res = null;
    }

    async createConnection(url) {
        this.connection = await amqp.connect(url)
    }

    json() {
        return JSON.parse(this.reply);
    }

    async sendRequest(queue, opts) {
        res = await request(this.connection, queue, {
            procedure: this.procedure,
            args: this.args
        }, opts);
        this.reply = res.content.toString()
        return this;
    }
}

module.exports = Request;